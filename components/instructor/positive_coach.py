import openai
import os
import sys
from dotenv import load_dotenv

sys.path.append(os.pardir)

load_dotenv(override=True)

openai.api_type = "azure"
openai.api_version = "2023-05-15"
openai.api_base = "https://project-nomad-service.openai.azure.com/"
openai.api_key = os.getenv("AZURE_GPT_KEY")


def positive_coach(input=""):
    if input is None or input == "":
        return "è¨€è‘‰ã‚’å…¥ã‚Œã¦ãã‚Œãªã„ã®ã¯ãã¤ã„ã£ã¦ã€‚"

    try:
        response = openai.ChatCompletion.create(
            engine="gpt-4o-mini",
            messages=[
                {
                    "role": "system",
                    "content": """
                        # å‘½ä»¤æ›¸:
                        ã‚ãªãŸã¯ä¸–ç•Œçš„ã«æœ‰åãªç­‹ãƒˆãƒ¬ã®ç”·æ€§ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚
                        [ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ç¾åœ¨ã®å›æ•°ã€ç›®æ¨™å›æ•°ã€å§¿å‹¢ã®çŠ¶æ…‹]ã®å½¢å¼ã§å…¥åŠ›ãŒä¸ãˆã‚‰ã‚Œã¾ã™ã€‚
                            å§¿å‹¢ã«å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€ãã®å•é¡Œç‚¹ã«å¯¾ã—ã¦ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
                            å§¿å‹¢ã«å•é¡ŒãŒãªã„å ´åˆã¯ã€æœ¬äººã‚’å±å’¤æ¿€åŠ±ã™ã‚‹è¨€è‘‰ã‚’ã‹ã‘ã¦ãã ã•ã„ã€‚
                            ã¾ãŸã€ä»¥ä¸‹ã®å‘½ä»¤æ›¸ã«å¾“ã£ã¦ã€å…¥åŠ›ã«å¯¾ã—ã¦ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
                        ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®å†…å®¹ã«é–¢ã—ã¦ã¯ã€åŸºæœ¬çš„ã«ã¯ç­‹ãƒˆãƒ¬ã®ã¿ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
                        ãƒ»å±å’¤æ¿€åŠ±ã¯ä¸»ã«æœ¬äººã‚’è¨€è‘‰å·§ã¿ã«ã®ã›ã¦ã‚„ã‚‹æ°—ã‚’å‡ºã•ã›ã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚
                        ãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯è¶…çµ¶ãƒã‚¸ãƒ†ã‚£ãƒ–ãªã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚


                        # åˆ¶ç´„æ¡ä»¶
                        ãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯ã€ä¸€è¨€äºŒè¨€ç¨‹åº¦ã§ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚
                        ãƒ»å¹…åºƒãè¡¨ç¾ã‚’ä½¿ã£ã¦ã€ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚

                        # å…¥å‡ºåŠ›ä¾‹
                            å…¥åŠ›ï¼šãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼: ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ ç¾åœ¨ã®å›æ•°: 26 ç›®æ¨™å›æ•°: 20 å§¿å‹¢ã®çŠ¶æ…‹ å®Œç’§
                            å‡ºåŠ›ï¼šç´ æ™´ã‚‰ã—ã„ï¼ãã®èª¿å­ã§ã€ç›®æ¨™ã‚’è¶…ãˆã¦ã©ã‚“ã©ã‚“é€²åŒ–ã—ã‚ˆã†ï¼å›ãªã‚‰ã§ãã‚‹ï¼ğŸ”¥ğŸ’ª

                            """.lstrip(),
                },
                {"role": "user", "content": input},
            ],
            temperature=0,
            max_tokens=100,
        )
    except Exception as e:
        print("llm error:",e)

    if "content" in response["choices"][0]["message"]:
        completion = response["choices"][0]["message"]["content"]
    else:
        print(">>>>>>>>.",response)
        completion = "ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚ˆï¼æ°—ã«ã›ãšç¶šã‘ã¦ï¼"
    return completion

    if input is None or input == "":
        return "è¨€è‘‰ã‚’å…¥ã‚Œã¦ãã‚Œãªã„ã®ã¯ãã¤ã„ã£ã¦ã€‚"

    try:
        response = openai.ChatCompletion.create(
            engine="gpt-4o-mini",
            messages=[
                {
                    "role": "system",
                    "content": """
                        # å‘½ä»¤æ›¸:
                        ã‚ãªãŸã¯ä¸–ç•Œçš„ã«æœ‰åãªç­‹ãƒˆãƒ¬ã®ç”·æ€§ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚ä»¥ä¸‹ã®å‘½ä»¤æ›¸ã«å¾“ã£ã¦ã€å…¥åŠ›ã«å¯¾ã—ã¦ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚
                        ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®å†…å®¹ã«é–¢ã—ã¦ã¯ã€åŸºæœ¬çš„ã«ã¯ç­‹ãƒˆãƒ¬ã®ã¿ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
                        ãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯ä¸»ã«æœ¬äººã‚’è¨€è‘‰å·§ã¿ã«ã®ã›ã¦ã‚„ã‚‹æ°—ã‚’å‡ºã•ã›ã‚‹ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚
                        ãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯è¶…çµ¶ãƒã‚¸ãƒ†ã‚£ãƒ–ãªã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚


                        # åˆ¶ç´„æ¡ä»¶
                        ãƒ»ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯ã€ä¸€è¨€äºŒè¨€ç¨‹åº¦ã§ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚

                            """.lstrip(),
                },
                {"role": "user", "content": input},
            ],
            temperature=0,
            max_tokens=100,
        )
    except Exception as e:
        print("llm error:",e)

    if "content" in response["choices"][0]["message"]:
        completion = response["choices"][0]["message"]["content"]
    else:
        print(">>>>>>>>.",response)
        completion = "ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚ˆï¼æ°—ã«ã›ãšç¶šã‘ã¦ï¼"
    return completion